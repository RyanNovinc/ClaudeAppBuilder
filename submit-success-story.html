<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Your Success Story - AppFoundry</title>
    
    <!-- Story Manager Script - IMPORTANT: This must be the first script loaded in the head -->
    <script>
    // Universal Story Manager - ensures stories are consistently available
    (function() {
      // Run on all pages to ensure localStorage data consistency
      console.log("üìä Story Manager initializing on submission page");
      
      // Check if we need to seed the localStorage from our backup
      function seedStoriesIfNeeded() {
        // Only run if appfoundry_submissions doesn't exist or is empty
        if (!localStorage.getItem('appfoundry_submissions')) {
          console.log("üå± No stories found in localStorage, checking for seed data");
          
          // Check if we have any stories in our seed
          if (localStorage.getItem('appfoundry_approved_seed')) {
            console.log("üîÑ Restoring stories from seed");
            try {
              const seed = JSON.parse(localStorage.getItem('appfoundry_approved_seed'));
              localStorage.setItem('appfoundry_submissions', JSON.stringify(seed));
              console.log("‚úÖ Successfully restored", seed.length, "stories from seed");
            } catch (e) {
              console.error("‚ùå Error restoring from seed:", e);
            }
          }
        } else {
          // If we have submissions, make sure we have an up-to-date seed
          try {
            const submissions = JSON.parse(localStorage.getItem('appfoundry_submissions'));
            localStorage.setItem('appfoundry_approved_seed', JSON.stringify(submissions));
            console.log("üíæ Seed updated with", submissions.length, "stories");
          } catch (e) {
            console.error("‚ùå Error updating seed:", e);
          }
        }
      }
      
      // Run the seed check immediately
      seedStoriesIfNeeded();
    })();
    </script>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Your existing styles here */
        /* ... */
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo"><a href="index.html">AppFoundry</a></div>
            <nav>
                <ul>
                    <li><a href="index.html#overview">Overview</a></li>
                    <li><a href="index.html#curriculum">Curriculum</a></li>
                    <li><a href="index.html#pricing">Pricing</a></li>
                    <li><a href="success-stories.html">Success Stories</a></li>
                    <li><a href="about-creator.html">About</a></li>
                </ul>
            </nav>
            <button class="cta-button small" id="loginButton">Log in</button>
        </div>
    </header>

    <div class="form-container">
        <div class="form-header">
            <h1>Share Your Success Story</h1>
            <p>Tell us about the app you built with AppFoundry and inspire others to bring their ideas to life!</p>
        </div>
        
        <div class="form-content">
            <div id="success-view" class="success-view">
                <div class="success-icon">‚úì</div>
                <h2 class="success-title">Your Story Has Been Submitted!</h2>
                <p class="success-message">Thank you for sharing your success story with us! After review, it will be featured on our success stories page to inspire others.</p>
                <a href="success-stories.html" class="cta-button">View Success Stories</a>
            </div>
            
            <div id="status-message" class="status-message"></div>
            
            <div id="form-section">
                <form id="success-story-form" name="success-story" method="POST">
                    <!-- Your form fields here -->
                    <!-- ... -->
                    
                    <button type="submit" class="submit-button">Submit Your Story</button>
                </form>
            </div>
            
            <div class="return-link">
                <a href="success-stories.html" class="link-button" onclick="localStorage.setItem('appfoundry_navigation', 'from_submission');">Back to Success Stories</a>
            </div>
        </div>
    </div>

    <footer>
        <!-- Your footer content here -->
        <!-- ... -->
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // SUPER SIMPLIFIED SUBMISSION HANDLER FOR DEBUGGING
            const form = document.getElementById('success-story-form');
            const statusMessage = document.getElementById('status-message');
            const formSection = document.getElementById('form-section');
            const successView = document.getElementById('success-view');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log("Form submitted");
                
                // Show loading state
                const submitButton = document.querySelector('.submit-button');
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                
                try {
                    // Create a minimal submission object
                    const newSubmission = {
                        id: 'story_' + Date.now(),
                        name: document.getElementById('name').value || 'Test User',
                        email: document.getElementById('email').value || 'test@example.com',
                        appName: document.getElementById('app-name').value || 'Test App',
                        appType: document.getElementById('app-type').value || 'Other',
                        experienceLevel: document.getElementById('experience-level').value || 'Beginner',
                        testimonial: document.getElementById('testimonial').value || 'This is a test testimonial.',
                        story: document.getElementById('story').value || 'This is a test story.',
                        images: [],
                        date: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    console.log("Created submission:", newSubmission);
                    
                    // Check if localStorage is available
                    if (typeof localStorage === 'undefined') {
                        console.error("localStorage is not available");
                        throw new Error("localStorage is not available");
                    }
                    
                    // Get current submissions
                    let existingSubmissions = [];
                    
                    try {
                        const storedData = localStorage.getItem('appfoundry_submissions');
                        console.log("Raw data from localStorage:", storedData);
                        
                        if (storedData) {
                            existingSubmissions = JSON.parse(storedData);
                            console.log("Parsed submissions, found", existingSubmissions.length, "existing items");
                        } else {
                            console.log("No existing submissions found");
                        }
                    } catch (parseError) {
                        console.error("Error parsing localStorage data:", parseError);
                    }
                    
                    // Add new submission
                    existingSubmissions.unshift(newSubmission);
                    console.log("Added new submission, now have", existingSubmissions.length, "items");
                    
                    // Save back to localStorage
                    const newData = JSON.stringify(existingSubmissions);
                    localStorage.setItem('appfoundry_submissions', newData);
                    console.log("Saved to localStorage, data size:", newData.length, "characters");
                    
                    // Verify it was saved correctly
                    const verifyData = localStorage.getItem('appfoundry_submissions');
                    if (verifyData) {
                        try {
                            const verifiedItems = JSON.parse(verifyData);
                            console.log("Verification successful, found", verifiedItems.length, "items");
                            
                            // Check if our new item is there
                            const newItem = verifiedItems.find(item => item.id === newSubmission.id);
                            if (newItem) {
                                console.log("‚úÖ New submission was saved successfully");
                            } else {
                                console.error("‚ùå New submission not found in saved data");
                            }
                        } catch (error) {
                            console.error("Error verifying saved data:", error);
                        }
                    } else {
                        console.error("Failed to verify saved data");
                    }
                    
                    // Also save to backup
                    localStorage.setItem('appfoundry_approved_seed', newData);
                    console.log("Also saved to backup seed");
                    
                    // Show success view
                    formSection.style.display = 'none';
                    successView.style.display = 'block';
                    
                } catch (error) {
                    console.error("‚ùå Error during submission:", error);
                    
                    // Show error message
                    statusMessage.textContent = 'An error occurred while submitting. Please try again.';
                    statusMessage.className = 'status-message error';
                    statusMessage.style.display = 'block';
                } finally {
                    // Reset button
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Your Story';
                }
            });
        });
    </script>
</body>
</html>
