function loadSubmissions() {
    const adminToken = localStorage.getItem('appfoundry_admin_token');
    
    if (!adminToken) {
        checkAdminLogin();
        return;
    }
    
    // Get elements
    const loadingIndicator = document.getElementById('loading-indicator');
    const storiesTable = document.getElementById('stories-table');
    const emptyState = document.getElementById('empty-state');
    
    // Show loading, hide others
    loadingIndicator.style.display = 'flex';
    storiesTable.style.display = 'none';
    emptyState.style.display = 'none';
    
    try {
        // Initialize all submissions array
        let allNetlifySubmissions = [];
        let localSubmissions = [];
        
        // Try to fetch from Netlify Function
        try {
            console.log('Attempting to fetch submissions from Netlify Function...');
            const response = await fetch('/.netlify/functions/get-submissions', {
                headers: {
                    'Authorization': `Bearer ${adminToken}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                console.log('Received data from Netlify Function:', data);
                allNetlifySubmissions = data;
            } else {
                console.warn('Function returned non-OK response:', response.status);
            }
        } catch (fetchError) {
            console.warn('Error fetching from API:', fetchError);
            // Continue with localStorage as fallback
        }
        
        // Get submissions from localStorage
        const storedSubmissions = localStorage.getItem('appfoundry_submissions');
        if (storedSubmissions) {
            try {
                localSubmissions = JSON.parse(storedSubmissions);
                console.log('Found submissions in localStorage:', localSubmissions.length);
            } catch (parseError) {
                console.error('Error parsing localStorage submissions:', parseError);
                localSubmissions = [];
            }
        }
        
        // Combine submissions (avoid duplicates by ID)
        const combinedSubmissions = [...allNetlifySubmissions];
        
        // Add local submissions that don't exist in the API data
        localSubmissions.forEach(localSub => {
            const exists = combinedSubmissions.some(apiSub => apiSub.id === localSub.id);
            if (!exists) {
                combinedSubmissions.push(localSub);
            }
        });
        
        // If we still have no submissions, use sample data
        if (combinedSubmissions.length === 0) {
            console.log('No submissions found, using sample data');
            allSubmissions = getSampleData();
        } else {
            console.log('Using combined submissions:', combinedSubmissions.length);
            allSubmissions = combinedSubmissions;
        }
        
        // Sort by date (newest first)
        allSubmissions.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Check if we have submissions
        if (allSubmissions.length === 0) {
            // Show empty state
            loadingIndicator.style.display = 'none';
            emptyState.style.display = 'block';
            return;
        }
        
        // Display submissions
        loadingIndicator.style.display = 'none';
        storiesTable.style.display = 'table';
        
        // Reset pagination
        currentPage = 1;
        
        // Display submissions
        displaySubmissions();
        
        // Log displayed submissions for debugging
        console.log('Displayed submissions:', allSubmissions.slice(0, 3));
    } catch (error) {
        console.error('Error loading submissions:', error);
        
        // Show error
        loadingIndicator.style.display = 'none';
        
        // Create error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'admin-empty-state';
        errorDiv.innerHTML = `
            <div class="admin-empty-state-icon">‚ùå</div>
            <div class="admin-empty-state-title">Error Loading Submissions</div>
            <p>We encountered an issue loading the submissions. Please try again.</p>
            <button class="admin-button" onclick="loadSubmissions()">Retry</button>
        `;
        
        // Add to container
        document.getElementById('table-container').appendChild(errorDiv);
    }
}
