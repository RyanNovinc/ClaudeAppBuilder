<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Your Success Story - AppFoundry</title>
    
    <!-- Simplified script for reliable localStorage submission -->
    <script>
    // Check if localStorage is working
    function checkLocalStorage() {
        try {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
            return true;
        } catch (e) {
            return false;
        }
    }
    </script>
    
    <!-- Include your existing CSS here -->
    <style>
        /* Keep your existing styles */
        /* ... */
        
        /* Add debug panel for troubleshooting */
        .debug-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f3f4f6;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Keep your existing header -->
    
    <div class="form-container">
        <div class="form-header">
            <h1>Share Your Success Story</h1>
            <p>Tell us about the app you built with AppFoundry and inspire others to bring their ideas to life!</p>
        </div>
        
        <div class="form-content">
            <!-- Success view -->
            <div id="success-view" class="success-view" style="display: none;">
                <div class="success-icon">âœ“</div>
                <h2 class="success-title">Your Story Has Been Submitted!</h2>
                <p class="success-message">Thank you for sharing your success story with us! After review, it will be featured on our success stories page to inspire others.</p>
                <a href="success-stories.html" class="cta-button">View Success Stories</a>
            </div>
            
            <div id="status-message" class="status-message"></div>
            
            <!-- Form section -->
            <div id="form-section">
                <form id="success-story-form">
                    <div class="form-group">
                        <label for="name">Your Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" required>
                            <div class="form-tip">Your email won't be displayed publicly.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="app-type">Type of App</label>
                            <select id="app-type" name="app-type" required>
                                <option value="" disabled selected>Select app category</option>
                                <option value="Health & Fitness">Health & Fitness</option>
                                <option value="Productivity">Productivity</option>
                                <option value="Lifestyle">Lifestyle</option>
                                <option value="Business">Business</option>
                                <option value="Education">Education</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Social">Social</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="experience-level">Your Experience Level</label>
                        <select id="experience-level" name="experience-level" required>
                            <option value="" disabled selected>Select your coding experience</option>
                            <option value="No experience">No coding experience</option>
                            <option value="Beginner">Beginner (less than 1 year)</option>
                            <option value="Intermediate">Intermediate (1-3 years)</option>
                            <option value="Advanced">Advanced (3+ years)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="app-name">Your App Name</label>
                        <input type="text" id="app-name" name="app-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="story">Your Success Story</label>
                        <textarea id="story" name="story" required placeholder="Tell us about your experience building your app with AppFoundry. What challenges did you overcome? How has it impacted you or your business?"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="testimonial">Short Testimonial (for display)</label>
                        <textarea id="testimonial" name="testimonial" required placeholder="Write a brief testimonial (1-2 sentences) that we can feature on our success stories page."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-button">Submit Your Story</button>
                    
                    <div class="form-note">
                        <p>By submitting this form, you agree to let us feature your story and app screenshots on our website.</p>
                    </div>
                </form>
                
                <!-- Debug panel to help with troubleshooting -->
                <div id="debug-panel" class="debug-panel">
                    <div>localStorage status: <span id="ls-status">Checking...</span></div>
                    <div>Existing submissions: <span id="existing-count">Checking...</span></div>
                    <button id="debug-button" style="margin-top: 10px; font-size: 12px; padding: 5px 10px;">Test localStorage</button>
                </div>
            </div>
            
            <div class="return-link">
                <a href="success-stories.html" class="link-button">Back to Success Stories</a>
            </div>
        </div>
    </div>

    <!-- Keep your existing footer -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Debug helpers - will be hidden in production
            const debugPanel = document.getElementById('debug-panel');
            const lsStatus = document.getElementById('ls-status');
            const existingCount = document.getElementById('existing-count');
            const debugButton = document.getElementById('debug-button');
            
            // Show debug panel with shift+D key combination
            document.addEventListener('keydown', function(e) {
                if (e.shiftKey && e.key === 'D') {
                    debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                    
                    // Update debug info
                    lsStatus.textContent = checkLocalStorage() ? 'Working' : 'Not working';
                    
                    try {
                        const submissions = JSON.parse(localStorage.getItem('appfoundry_submissions') || '[]');
                        existingCount.textContent = submissions.length;
                    } catch (e) {
                        existingCount.textContent = 'Error: ' + e.message;
                    }
                }
            });
            
            // Test button
            debugButton.addEventListener('click', function() {
                try {
                    // Try to write a test submission
                    const testSubmission = {
                        id: 'test_' + Date.now(),
                        name: 'Test User',
                        email: 'test@example.com',
                        appName: 'Test App',
                        appType: 'Test',
                        testimonial: 'This is a test submission.',
                        story: 'This is a test story for debugging purposes.',
                        date: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    // Get existing or create new array
                    let submissions = [];
                    try {
                        const existingData = localStorage.getItem('appfoundry_submissions');
                        if (existingData) {
                            submissions = JSON.parse(existingData);
                        }
                    } catch (e) {}
                    
                    // Add the test submission
                    submissions.unshift(testSubmission);
                    
                    // Save back to localStorage
                    localStorage.setItem('appfoundry_submissions', JSON.stringify(submissions));
                    localStorage.setItem('appfoundry_approved_seed', JSON.stringify(submissions));
                    
                    // Update counts
                    existingCount.textContent = submissions.length;
                    
                    alert('Test submission added successfully!');
                } catch (e) {
                    alert('Error adding test submission: ' + e.message);
                }
            });
            
            // Form submission
            const form = document.getElementById('success-story-form');
            const statusMessage = document.getElementById('status-message');
            const formSection = document.getElementById('form-section');
            const successView = document.getElementById('success-view');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Show loading state
                const submitButton = document.querySelector('.submit-button');
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                
                try {
                    // Get form data - simplified version without image processing
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const appType = document.getElementById('app-type').value;
                    const appName = document.getElementById('app-name').value;
                    const story = document.getElementById('story').value;
                    const testimonial = document.getElementById('testimonial').value;
                    const experienceLevel = document.getElementById('experience-level').value;
                    
                    // Create submission object
                    const newSubmission = {
                        id: 'story_' + Date.now(),
                        name,
                        email,
                        appName,
                        appType,
                        experienceLevel,
                        testimonial,
                        story,
                        images: [], // No images in simplified version
                        date: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    // Get existing submissions
                    let submissions = [];
                    const existingData = localStorage.getItem('appfoundry_submissions');
                    if (existingData) {
                        submissions = JSON.parse(existingData);
                    }
                    
                    // Add new submission to beginning of array
                    submissions.unshift(newSubmission);
                    
                    // Save back to localStorage
                    localStorage.setItem('appfoundry_submissions', JSON.stringify(submissions));
                    localStorage.setItem('appfoundry_approved_seed', JSON.stringify(submissions));
                    
                    // Hide form and show success view
                    formSection.style.display = 'none';
                    successView.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error submitting form:', error);
                    
                    // Show specific error message
                    statusMessage.textContent = 'Error: ' + error.message;
                    statusMessage.className = 'status-message error';
                    statusMessage.style.display = 'block';
                } finally {
                    // Reset button regardless of outcome
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Your Story';
                }
            });
        });
    </script>
</body>
</html>
